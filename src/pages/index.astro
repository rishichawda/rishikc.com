---
import Hero from "../components/landing/hero.astro";
import ArticlesPreview from "../components/landing/articles_preview.astro";
import CallToAction from "../components/landing/call_to_action.astro";
import Services from "../components/landing/services.astro";
import "../styles/global.css";
import BaseLayout from "../layouts/base_layout.astro";
import { Schema } from "astro-seo-schema";
import favicon from "../../content/assets/logo/logo.png";
import { getCollection } from "astro:content";

interface Social { platform: string; url: string; }
interface Position { title: string; }
interface Experience { company: string; positions: Position[]; }
interface ProfileData { name: string; title: string; summary: string; experience: Experience[]; socials: Social[]; }

const profileEntry = await getCollection("profile");
const profile = profileEntry[0].data as ProfileData;

const page_info = {
	title: `${profile.name} - ${profile.title}`,
	description: `${profile.name} - ${profile.title}`,
	keywords: `${profile.name} - ${profile.title}`,
};

const siteUrl = new URL(
	Astro.url.pathname,
	Astro.site || "https://rishikc.com",
).toString();
---

<BaseLayout page_info={page_info}>
	<Schema
		slot="head"
		item={{
			"@context": "https://schema.org",
			"@type": "Person",
			name: profile.name,
			jobTitle: profile.title,
			worksFor: {
				"@type": "Organization",
				name: profile.experience[0]?.company || "Unknown Company",
			},
			url: siteUrl,
			image: `${siteUrl.replace(/\/$/, "")}/${favicon.src}`,
			description: profile.summary,
			sameAs: profile.socials.map((social: Social) => social.url),
		}}
	/>
	<main>
		<Hero />
		<Services />
		<ArticlesPreview />
		<CallToAction />
	</main>
	
	<script>
		// Intersection Observer for scroll animations
		const observerOptions = {
			threshold: 0.1,
			rootMargin: '0px 0px -50px 0px'
		};

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					entry.target.classList.add('revealed');
				}
			});
		}, observerOptions);

		// Add scroll reveal to sections
		document.addEventListener('DOMContentLoaded', () => {
			const sections = document.querySelectorAll('section:not(:first-child)');
			sections.forEach(section => {
				section.classList.add('scroll-reveal');
				observer.observe(section);
			});
		});

		// Re-initialize on page load for Astro
		document.addEventListener('astro:page-load', () => {
			const sections = document.querySelectorAll('section:not(:first-child)');
			sections.forEach(section => {
				section.classList.add('scroll-reveal');
				observer.observe(section);
			});
		});
	</script>
</BaseLayout>
